
Makibox A6 Firmware - History / Change Log
==========================================

Please add most recent change logs / history to the top of the list.
Save as plain text file so that no special tools are required to view this file.


--------------------------
DATE: 	05 July 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Adjusted 'SLOWDOWN' feature in planner.c. Previously the slowdown was invoked if 
the plan buffer was less than half full and the number of moves queued in the 
buffer was greater than 1. This sometimes caused annoying slow down of movements 
when manually adjusting the printer using host software such as Pronterface. 
When the plan buffer is filled with more than 1 movement (e.g. sending multiple 
movement commands in quick succession or pressing a movement key multiple times 
quickly) then the moves can take a long time to complete. 

Now the SLOWDOWN feature is only invoked if there are more than 
MIN_MOVES_QUEUED_FOR_SLOWDOWN moves in the plan buffer and it is less than half 
full. MIN_MOVES_QUEUED_FOR_SLOWDOWN is defined in config.h and is initially set 
to 8. This should provide a happy medium between user experience when operating 
the printer manually from host software and preventing buffer under-run 
situations during a print.

Adjusted heater_table.h so that readings down to -40 degC are read for the 
hot-bed and the hot-end. Allows for better thermistor error / fault indication 
(e.g. disconnected thermistor). A reading of -40 degC will very likely indicate 
a fault. Previously the lowest reading reported was 0 degC. Starting the printer 
on a particularly cold winter day could generate a genuine of 0 degC.


--------------------------
DATE: 	21 June 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Added support for M18 (to turn off / disable motors). This operates in exactly 
the same way as M84 which is already implemented. Users have reported that the 
OctoPrint host software sends a M18 command when trying the stop / disable motors. 
Pronterface / PrintRun sends a M84 when the 'Motors Off' button is pressed.

NOTE: Please remember that the bed thermistor table is for the newer hot-bed 
where the thermistor has been located on the bottom of the board and positioned 
at the centre.


--------------------------
DATE: 	05 June 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
heater.h
Did not seem to like it when the bed thermistor table was removed. Firmware 
seemed to crash, reset, or exhibit unexpected behaviour during print. Putting 
the table back appears to fix the problem for now. There is some unknown memory 
issue going here. Got it working for now (Version 1.3.25l-VCP) and it seems 
stable. Need to come back at some point to figure out what the memory issue is 
and fix/identify it properly.

heater.h
Change bed thermistor to use same lookup table as the extruder thermistor. This 
is for the new hot bed - the thermistor has been relocated to the centre of the 
bed on the underside.


--------------------------
DATE: 	30 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
makibox.c
Fixed bug in homing_routine() where we were setting the actual steps count using 
the absolute positions in mm instead of number of steps.

Added some further configurable settings for development and testing activities.


--------------------------
DATE: 	29 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Merged the 'default' branch and the 'pause-resume' development branch.

Note SRAM usage is currently rather high. Bear this in mind when adding further 
features and adding more variables / strings / arrays. You may run in to stack 
overflow problems. Reducing the plan buffer size may be a way to go if 
difficulties are enountered BUT the plan buffer size was set to 64 to prevent 
it from being completely run dry when there are a series of relatively short 
moves.


--------------------------
DATE: 	17 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
config.h  makibox.c
Added the following defines...

#define HOTEND_MAX_TARGET_TEMP	260
#define BED_MAX_TARGET_TEMP		140

These are used to limit the maximum target temperatures of the hotend and hoted 
that can be set by the host / user. Requests for targets greater than these 
temperatures result in the target temperature being set to the max values defined.

Changed X and Y max acceleration settings so that they are now:
_MAX_ACCELERATION_UNITS_PER_SQ_SECOND {600,600,50,5000}


--------------------------
DATE: 	16 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
heater.c
Only allow extruder heater to be turned on with 100% duty if bed temperature has 
reached MIN_BED_TEMP_FOR_HOTEND_FULL_PWR (defined in heater.h). The extruder 
heater will be limited to a 33% duty until then. This is to try and limit the 
max/peak power drawn from the power supply.

config.h
Changed X and Y max acceleration settings so that they are now:
_MAX_ACCELERATION_UNITS_PER_SQ_SECOND {200,200,50,5000}


--------------------------
DATE: 	09 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Updated MAXTEMP from 300 to	260 - limits maximum temperature of hot-end to 
260 degC. Updated BEDMAXTEMP from 200 to 140 - limits maximum temperature of 
hot-bed to 260 degC. Note that when these temperatures are exceeded the firmware 
automatically sets the target temperature to 0 degC (i.e. switch off) for 
safety.


--------------------------
DATE: 	02 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Added code in stepper.c to turn off x/y/z stepper motors if they are not 
required for the current 'block'. This is in order to reduce the power 
dissipation (heating) in the stepper motors.

This code will be copied from the 'pause-print' development branch to the main /
default branch since this is a feature request for the near future.


--------------------------
DATE: 	07 MAR 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Added display of X Y Z max lengths to M119 command.
 

--------------------------
DATE: 	10 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
MIN_SOFTWARE_ENDSTOPS set to 1 in config.h. This is to prevent the printer from 
moving to positions less than zero. Only prevent moves to negative positions if 
the axis has been homed.

Also changed actual_steps_x, actual_steps_y, and actual_steps_z to signed long. 
This is so that they can be used to detect steps / moves less than zero. 
Sometimes when attempting to move to positions less than zero, the point at 
which the  end-stop switches are actuated and detected may vary resulting in 
the motors moving in to negative steps.


--------------------------
DATE: 	08 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
'pause-print' feature development.

Added wait_extruder_target_temp() and wait_bed_target_temp() functions in 
makibox.c. Waits for target temperatures to be reached before continuing. Same 
code as used in M109 and M190 previously. Can now be used in other areas of code 
such as the resume from a paused print in M226.


--------------------------
DATE: 	02 MAY 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Added code in stepper.c to turn off x/y/z stepper motors if they are not 
required for the current 'block'. This is in order to reduce the power 
dissipation (heating) in the stepper motors.

This code will be copied from the 'pause-print' development branch to the main /
default branch since this is a feature request for the near future.


--------------------------
DATE: 	26 APR 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
New attempt at pause-print feature. When a pause print is requested, a 
pause_print_req flag is raised. The current buffer block is allowed to complete 
printing then the current state of the printer is saved (including hot-end 
target temp, hot-bed target temp, x y z positions, block_buffer_head, 
block_buffer_tail). The first 8 blocks (starting at index 0) from the buffer 
are copied. The buffer size is then reduced to PRINT_PAUSED_BLOCK_BUF_SIZE and 
the buffer is re-initialised so that block_buffer_head and block_buffer_head are 
0.

To invoke the pause-print feature in Pronterface... Press the 'Pause' button to 
stop Pronterface from sending further Gcodes from the file to the printer. Send 
command M226 P1 to stop the printer from printing the rest of its print buffer 
and save the printer state. The user should now be able to move the x y z axes 
and extrude and fix any issues (e.g. jammed filament).

To resume the print, send command M226 P0 to the printer and press the 'Resume' 
button in Pronterface so that it will start sending Gcodes from the file to the 
printer. The printer should move x y z axes to the positions they were at when 
the pause was invoked and continue printing.

Still work in progress! 


--------------------------
DATE: 	16 APR 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Snap shot of current state pushed to repository before having a go with 
different approach for the pause-print feature.


--------------------------
DATE: 	06 MAR 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Commented out #define PID_AUTOTUNE to remove PID autotune function. We have not 
seen this work sucessfully yet with the Makibox A6 hardware. Perhaps we can add 
this back in later once we have seen it work properly or adjusted the algorithm 
slightly.

Allow PID paramters for the hotend to be adjusted via the M301 command.

Set #define DEBUG to -1 since we are not using the debug info or CPU loading 
estimates at the moment. Saves the microprocessor from having to do these 
calculations.

Fix M109 reporting bed temperature incorrectly - was essentially using the 
wrong table during the waiting for hotend temperature to reach target.


--------------------------
DATE: 	05 MAR 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Further tidying up of store_eeprom.c

Fix M190 reporting bed temperature incorrectly - was essentially using the 
wrong table during the waiting for bed temperature to reach target.

eeprom and default branches merged.

BOOTLOADER_PASSCODE changed to 3464 to make it more simple. The U40 code would 
probably not have been processed properly as the command parser looks for a 
number after the letter 'F'

plan_set_position() called when M92 is run in order to reset current position 
since steps per mm have changed.


--------------------------
DATE: 	01 MAR 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
M502 - restore default settings now will save the default settings back to the 
EEPROM as well.

Add checksum and validation of checksum when reading the data back. This is 
more reliable than checking a EEPROM version number which needs to be altered 
manually by the programmer.

Refactoring of the store_eeprom.c functions since the 'template' class 
(C++ feature) is not available in C.

New config.h setting for extrusion steps per mm based on feedback from 
mechanical testing.


--------------------------
DATE: 	28 FEB 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Slight adjustment to calibration table for hotbed. Looks like there is some 
hysteresis in the hotbed so readings may not be as accurate when cooling down.


--------------------------
DATE: 	27 FEB 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
heater_table.h -> Rough calibration for Makibox A6 Hotbed (initial Beta version).
Calibrated to temperature near centre of the Hotbed using a K-Type 
Thermocouple.
Note: temperature differences / gradients around other areas of the 
Hotbed have been ignored for now.


--------------------------
DATE: 	25 FEB 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Edited M114 position reporting - do_position_report() - so now the millimeters 
reporting conforms to the RepRap format with "C:" prefixed to indicate that 
coordinates follow. 


--------------------------
DATE: 	22 FEB 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Ability to track the positions of the X, Y, Z, and E axes added. This is based 
on counting the actual numer of steps issued to the stepper driver. The system 
must be homed first for accurate position feedback. On first power up, the 
existing positions are assumed to be the zero position (X, Y, and Z will not 
display negative positions - zero is the minimum).

M114 now uses a new function in makibox.c to output text feedack for the 
position.

Slight update to the make file.


--------------------------
DATE: 	21 FEB 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Slight tweaks to the planner.c and stepper.c split files.



--------------------------
DATE: 	20 FEB 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Split stepper ISR and related code from planner.c and added new file - stepper.c



--------------------------
DATE: 	14 FEB 2013
AUTHOR:	JTK WONG
		XTRONTEC Limited
		www.xtrontec.com
--------------------------
Created history.txt and copied old history text source files to the bottom of 
this file.

Slight adjustment of PID parameters.

Added manage_heaters() call back in to the manage_inactivity() function. This 
is called by the main / background loop. The timer 1C ISR is still present and 
calls the manage_heaters() function. This attempts to guard against any infinite
or long loops in other parts of the code.

Added fcpu_div_500k = (F_CPU/500000L) in calc_timer() so that the result can be 
used within the function rather than calculating each time as before (division 
is relatively demanding). The compiler may optimise the resulting assembler but 
we will just use a tiny bit more memory just to be sure.

   


------------------------------------------------------------
Old history text removed from source files and added here...
------------------------------------------------------------

/* heater.c
*
* History:
* =======
*
* +		08 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		Added init_Timer3_HW_pwm(void) to initialise Timer 3 for hardware
*		PWM. Phase correct PWM rate set at 500Hz similar to SOFT_PWM.
*
* +		14 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		First attempt to add PWM and PID control for Hot Bed heater. Basically
*		just replicating PID control code for the extruder heater which is also
*		within manage_heater(). The code could do with being tidied up some more
*		when time permits - too many lines of code in one function.
*
* +		15 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Removed some unused variables and functions.
*		Removed code for MAX6675 and AD595 thermocouple amplifier / interface
*		ICs since they are unlikely to be used with the Makibox.
*
*		controllerFan() removed as controller fan pin defined in previous code
*		does not map to suitable control pin on PrintRBoard rev B.
*
*		extruderFan() removed as extruder fan pin defined in previous code
*		does not map to suitable control pin on PrintRBoard rev B.
*
* +		02 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Modified PID algorithms for the hotend and hotbed temperature control.
*		Removed the initial H0 starting value from the P-term calculation.
*		Reset temp_istate values to zero if outside of I-term control range.
*		Removed divisions based on error range for the D-term calculation.
*
* +		08 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Refactored manage_heater() slightly.
*
* +		06 FEB 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		now using Timer 1C to regularly service the heater control for the hot 
*		end and hot bed. This is better than the previous case where the 
*		manage_heater() function had to be called in various places within the 
*		main code. This potentially had the  situations where the heater 
*		control would be held off or not serviced. Now with the heater control 
*		provided via an ISR there is less chance of the heaters not being 
*		serviced properly due to coding errors causing accidental delay or 
*		infinite loop elsewhere.
*
* +		07 FEB 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Changed watch_raw to watch_temp. Slight adjustment to temperature 
*		watch period checking. Now checks temperature value instead of the raw
*		value. Easier to understand and avoids errors if the thermistor 
*		temperature table was ever changed (e.g. NTC vs PTC type). 
*
*		Edited PID control calculations to do right shifts instead of divide by
*		256. 
*/


/* makibox.c
*
* History:
* =======
*
* + 	02 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		Corrected missing ")" for function call to analogWrite_check()
*		within function 'execute_mcode'.
*
*		Moved function prototype for analogWrite_check() to makibox.h
*		so that it can be called from heater.c
*
* +		08 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		Replaced calls to analogWrite_check(FAN_PIN, l_fan_code_val);
*		with analogWrite(FAN_PIN, l_fan_code_val);. analogWrite_check()
*		does not appear to do much - perhaps an issue with the preprocessing
*		#defines.
*
*		Minor correction for missing ")" in function call within 
*		manage_fan_start_speed().
*
* +		16 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Removed analogWrite_check() function. Replaced calls to analogWrite 
*		with calls to setFanPWMDuty() and setHeaterPWMDuty() functions.
*		A few other edits to remove code and function calls not required.
*
* +		30 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Added commands to help debug system with information such as CPU loading
*		and ISR execution times. Rough indicators only. Custom commands M604 to 
*		M607. 
*
* +		07 Dec 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Ignore command sequence numbers since this was causing a problem with
*		Pronterface. With 'monitor printer' switched on the sequence numbers
*		go out of sync and cause printing problems..
*
*		read_command() now ignores characters after a ";" as these are comments.
*
* +		14 Dec 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Fix bug in find_word() parsing function. Previously it was checking for 
*		a white space after the command terminator. This resulted in occasional 
*		incorrect reporting that there was an error if there was a white space 
*		left over beyond the therminating character from the previous command 
*		in the buffer. Now checks for white space immediately after the 'word' 
*		found.
*
*		M105 command's temperature reporting text format edited to be compatible 
*		with Pronterface graphing ('monitor printer') feature.
*
*		Minor editing of execute_gcode() and execute_mcode() large switch 
*		statements to make the formating more consistent (e.g. removed use of
*		curly brackets around some cases).
*
* +		17 Dec 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		find_word() now checks for the "\0" terminating character after finding
*		the 'word'.
*
* +		18 DEC 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		TEMP_HYSTERESIS is used to provide an acceptable target temperature
*		band before M109 returns and allows the print to proceed. Previously, 
*		the temperature can sometimes hover 1 or 2 degC above target and not be 
*		able to begin printing unless the extruder head was 'blown' on to reduce 
*		the temperature below the target.
*
* +		24 DEC 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Added M852 command to allow entry in to the DFU bootloader via the
*		firmware application. This will allow the Makibox firmware to be 
*		updated without the need to open up the Makibox and press the reset 
*		button on the PrintRBoard or mess around with removing / reconnecting
*		jumpers. A 'F' pass code must also be entered together with the M852
*		command. This is to prevent accidental entry in to the bootloader by
*		end-users.
*
* +		02 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		M105 command edited to provide bed heater duty information. Duty cycles
*		now reported as a percentage.
*
* +		15 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Edit M109 and M190 wait for temperature commands so that the text format
*		is compatile with Pronterface's graphing feature.
*
*		M109 and M190 wait for target temperature commands. Added check and 
*		feedback text for situation where the target temperature has been reset 
*		to zero. This may happen if the thermistor or heater connections are 
*		disconnected.
*
* +		25 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Added M112 - Emergency Stop - disables all motors and heaters and then
*		restarts the firmware (keeps USB connection active). Emergency stop 
*		button (sends M112) is availale in the Repetier Host GUI.
*
* +		30 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Added M112 - Emergency Stop - disables all motors and heaters and then 
*		restarts the firmware (keeps USB connection active). Emergency stop 
*		button (sends M112) is availale in the Repetier Host GUI.
*		Enable the watchdog timer. Set to 4 seconds. This is to cover situations
*		where the firmware hangs for some unexpected reason.
*		Added M609 - Show the reset flags (in hex format) from the last reset.
*
* +		31 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Disabled watchdog timer as this was being triggered by some of the 
*		longer operations such as the homing routine. Perhaps consider 
*		implementing a workable system watchdog again later if time allows.
*
* +		06 FEB 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Removed calls to manage_heater(). This is now called regularly via an 
*		ISR triggered by timer 1C.
*/


/* pins_teensy.c
 *
 * History:
 * =======
 *
 * +		16 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
 *												www.xtrontec.com
 *			Removed analogWrite() function as it is no longer used anywhere.
 * 
 */
 

/* planner.c
*
* History:
* =======
*
* +		28 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		ISR(TIMER1_COMPA_vect) nop instruction added to ensure that pulse width 
*		generated meets the	minimum requirement for the Allegro A4982 stepper 
*		motor driver input.
*		The existing code relies on delays in executing commands between setting
*		the step high and stepping it low again to meet the A4982's minimum pulse 
*		width requirement. Some motor drive issues have been seen during 
*		development testing which may be related to this.
*		
*		*** NOTE ***
*		THIS IS A QUICK AND DIRTY HACK TO GET THINGS WORKING A
*		BIT BETTER. RECOMMEND THAT THIS ISR IS RE-VISITED AND REFACTORED TO
*		TO WORK PROPERLY AND GENERATE THE CORRECT PULSE WIDTHS FOR THE A4982
*		DRIVER IC.
*
* +		29 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Added some very rough indicators of ISR execution time for 
*		ISR(TIMER1_COMPA_vect).
*
* +		30 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		ISR(TIMER1_COMPA_vect) added another nop loop after the stepper pulse
*		has been pulled low. This is to ensure that the minimum low pulse width
*		is met for the A4982.
*
* +		17 Dec 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Added casting and literals for division calculations in order to guard
*		against integer division problems.
*
* +		06 Feb 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		st_init() now also initialises timer 1C.
*/


/* config.h
*
* History:
* =======
*
* + 	02 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		Commented out #define FAN_SOFT_PWM and #define PID_SOFT_PWM. This is to 
*		free up Timer 2. Slightly less processing as the Timer 2 ISRs are no 
*		longer called.
*
* +		14 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		Added some defines associated with HOT BED PID control. PID parameters 
*		have been copied from the extruder heater PID settings. The PID 
*		parameters will need to be tuned for the hot bed and adjusted here.
*
* +		15 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Removed controller fan pin defines
*		Does not map to suitable control pin on PrintRBoard rev B.
*
*		Removed extruder fan pin defines.
*		Does not map to suitable control pin on PrintRBoard rev B.
*
* +		29 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Added global variables for CPU loading calculation.
*		Added DEBUG #define to enable/disable calculation.
*
* +		07 Dec 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		HEATER_CHECK_INTERVAL decreased to 100 so that extruder temperature is 
*		checked (sampled) more frequently. Extruder PID parameters edited.
*
* +		17 Dec 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Change MAXTEMP to 300 to limit extruder heater to 300 degC.
*
* +		18 Dec 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Uncomment TEMP_RESIDENCY_TIME and TEMP_HYSTERESIS defines and set to
*		10 seconds and 2 degC respectively. This to see if it helps with print
*		quality issues seen on the initial layers of prints. Upper layers seem 
*		to stabilise and produce better quality / more consistent output during
*		initial development testing. Suspect it could be a temperature issue 
*		with the ABS plastic. The use of TEMP_RESIDENCY_TIME will ensure that 
*		when the wait for extruder temperature command is issued the printer 
*		will wait for the temperature to stabilise to the target for at least 
*		TEMP_RESIDENCY_TIME (set to 10 seconds for now) before continuing to 
*		print.
*
*		TEMP_HYSTERESIS is also used to provide an acceptable target temperature
*		band before M109 returns and allows the print to proceed. Previously, 
*		the temperature can sometimes hover 1 or 2 degC above target and not be 
*		able to begin printing unless the extruder head was 'blown' on to reduce 
*		the temperature below the target.  
*
* +		27 Dec 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Increased BED_PID_IGAIN to 120.
*
*		Uncomment WATCHPERIOD. This enables checks of the hotend heater when a
*		target temperature is set. If the temperature does not appear to be 
*		increasing after WATCHPERIOD has elapsed then the target temperature is
*		set to 0 degC in order to protect the hotend heater. This situation 
*		may occur if the hotend thermistor has not been installed at the right 
*		location and therefore not measuring the hotend temperature.
*
* +		02 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Update _AXIS_STEP_PER_UNIT with new value for extruder stepping. New 
*		PID settings for the hotend and hotbed heaters for the slightly modified
*		PID algorithms.
*		Removed some redundant #defines.
*		BED_CHECK_INTERVAL reduced to 1000 in order to give slightly better 
*		temperature control of the hotbed.
*
* +		09 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Increased BLOCK_BUFFER_SIZE to 64 in order to test if this will prevent
*		stops / pauses during some prints - suspect that it may be due to buffer
*		under run.
*
* +		15 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Increased DROP_SEGMENTS to 50. _AXIS_STEP_PER_UNIT changed to 240 for 
*		the new extruder drive - needs to be double checked with final drive 
*		design.
*
*		Added BED_HEATUP_TIMEOUT and HOTEND_HEATUP_TIMEOUT.
*
*		Removed thermistor selection defines (THERMISTORHEATER and 
*		THERMISTORBED) from config.h since they are not used anywhere.
*
* +		30 JAN 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		INVERT_E_DIR is set to 1 currently for use in the Alpha boxes. For the 
*		Beta boxes this needs to be changed to 0. _AXIS_STEP_PER_UNIT extruder 
*		config set changed to 200.
*
* +		05 FEB 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Slight tweek to the hot end PID parameters to tune for the newer hot 
*		end design.
*
*		INVERT_E_DIR now set to 0. The extruder drive on the alpha unit has 
*		been modified to be in the same orientation as the beta units.
*
* +		07 FEB 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Reduced extruder steps per mm to 240.
*/


/* heater.h
*
* History:
* =======
*
* +		08 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		Added init_Timer3_HW_pwm(void) to initialise Timer 3 for hardware
*		PWM. 
*
* +		14 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		Added some variales associated with HOT BED PID control. 
*
* +		15 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Removed some unused variables and function prototypes. 
*
* +		07 FEB 2013		Author: JTK Wong 	XTRONTEC Limited
*											www.xtrontec.com
*		Changed watch_raw to watch_temp.
*/


/* makibox.h
*
* History:
* =======
* + 	02 NOV 2012		Author: JTK Wong (XTRONTEC Limited)
*		Moved function prototype for analogWrite_check() to makibox.h
*		so that it can be called from heater.c
*/


/* pins_teensy.h
 * History:
 * =======
 *
 * +		16 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
 *												www.xtrontec.com
 *			Removed analogWrite() function as it is no longer used anywhere.
 *			Removed "pinMode" related Teensy functions - not used.
 *
 * +		21 NOV 2012		Author: JTK Wong 	XTRONTEC Limited
 *												www.xtrontec.com
 *			Removed extern void _init_Teensyduino_internal_(void); as it is
 *			not used anywhere.
 */


